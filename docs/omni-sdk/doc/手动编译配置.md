[<<返回上一页](/docs/omni-sdk/doc/GeneralCompilation.md#手动编译配置) [<<返回首页](/sdk-docs)

手动编译配置
====

<!-- TOC -->

- [使用 KSSYOmniPlugin](#使用-kssyomniplugin)
- [游戏手动配置](#游戏手动配置)
    - [参数说明](#参数说明)
    - [配置方式](#配置方式)
    - [移除节点方法](#移除节点方法)
        - [功能](#功能)
        - [渠道](#渠道)

<!-- /TOC -->

# 使用 KSSYOmniPlugin

- 使用 `KSSYOmniPlugin` 游戏只要更新 `KSSYOmniPlugin` 版本号，无需关心不同渠道或功能的的特殊配置。
- 使用 `KSSYOmniPlugin` 游戏只要使用一个分支即可管理所有渠道。
- `KSSYOmniPlugin` 不仅提供基础编译功能，还提供多渠道包出包、 CPS渠道标签包出包等功能。

# 游戏手动配置

- 如果不使用 `KSSYOmniPlugin`，则需要游戏根据接入的功能、渠道，进行配置。
- 并且每个渠道需要单独拉取分支开发（虽然代码可以一样，但是渠道配置会不一样）。
- 需要移除 kssyOmniPlugin.gradle 文件。

## 参数说明
```json
"facebookAppId"       : "Facebook帐号，无值则需要移除相应节点",
"facebookAppName"     : "Facebook帐号，无值则需要移除相应节点",
"appId"               : "sunit渠道，渠道必填",
"googleAdmobAppid"    : "sunit渠道-admob广告，无值则需要移除相应节点",
"applovinKey"         : "sunit渠道-applovin广告，无值则需要移除相应节点",
"flurryApiKey"        : "sunit渠道-flurry数据，无值则需要移除相应节点",
"oppoAppKey"          : "oppo渠道，渠道必填",
```


## 配置方式
- 查阅对应渠道的 `project_config.json` 获取下面对应字段值。

```groovy
android {
    defaultConfig {
        applicationId "${json_package_name}"

        // 将 参数配置 写入AndroidManifest.xml
        def manifestMap = ["facebookAppId"       : "json_value",
                           "facebookAppName"     : "json_value",
                           "appId"               : "json_value",
                           "googleAdmobAppid"    : "json_value",
                           "applovinKey"         : "json_value",
                           "flurryApiKey"        : "json_value",
                           "oppoAppKey"          : "json_value"] // 无值则需要移除相应节点
        manifestPlaceholders.putAll(manifestMap)

        // sunit 茄子渠道专用
        resValue "string", "account_type", "${applicationId}.type"
        resValue "string", "content_authority", "${applicationId}.provider"
        // sunit 茄子渠道专用
      
      	// xsolla 渠道
        // xsolla 渠道页面跳转scheme
      	resValue "string", "xsolla_payments_redirect_scheme", "json_value" // json-key:redirectScheme
        // xsolla 渠道页面跳转host
     		resValue "string", "xsolla_payments_redirect_host", "json_value"   // json-key:redirectHost
      	// xsolla 渠道
       
        // vk 
      	resValue "integer", "com_vk_sdk_AppId", "json_value"   // json-key:vkAppId
        // vk
    }
}
```

## 移除节点方法
无值，且需要移除相应节点，将下面对应引用值节点都改成 `tools:node="remove"`

### 功能
- Facebook 功能

    ```xml
        <application>
            <meta-data
                android:name="com.facebook.sdk.ApplicationId"
                android:value="\${facebookAppId}"
                tools:node="merge"
                tools:replace="android:value" />
    
            <activity
                android:name="com.facebook.FacebookActivity"
                android:configChanges="keyboard|keyboardHidden|screenLayout|screenSize|orientation"
                android:label="\${facebookAppName}"
                tools:node="merge"
                tools:replace="android:label" />
    
            <activity
                android:name="com.facebook.CustomTabActivity"
                android:exported="true"
                tools:node="merge">
                <intent-filter>
                    <action android:name="android.intent.action.VIEW" />
    
                    <category android:name="android.intent.category.DEFAULT" />
                    <category android:name="android.intent.category.BROWSABLE" />
    
                    <data android:scheme="fb${facebookAppId}" />
                </intent-filter>
            </activity>
    
            <provider
                android:name="com.facebook.FacebookContentProvider"
                android:authorities="com.facebook.app.FacebookContentProvider${facebookAppId}"
                android:exported="true"
                tools:node="merge" />
    
        </application>
    ```

### 渠道
- OPPO 渠道

    ```xml
        <application>
            <!-- 日志开关，发布时候设置为false -->
            <meta-data
                android:name="debug_mode"
                android:value="false"
                tools:node="merge"
                tools:replace="android:value" />
    
            <!-- true:单机游戏 false:网游 -->
            <meta-data
                android:name="is_offline_game"
                android:value="false"
                tools:node="merge"
                tools:replace="android:value" />
    
            <meta-data
                android:name="app_key"
                android:value="\${oppoAppKey}"
                tools:node="merge"
                tools:replace="android:value" />
    
        </application>
    ```

- sunit渠道

    ```xml
        <application>
    
            <meta-data
                android:name="com.ushareit.ads.KEY_APP_ID"
                android:value="\${appId}"
                tools:node="merge"
                tools:replace="android:value" />
    
            <!--如需集成admob，无则改成 `tools:node="remove"`以便编译时移除 -->
            <meta-data
                android:name="com.google.android.gms.ads.APPLICATION_ID"
                android:value="\${googleAdmobAppid}"
                tools:node="merge"
                tools:replace="android:value" />
    
            <!--如需集成 applovin，无则改成 `tools:node="remove"`以便编译时移除 -->
            <meta-data
                android:name="applovin.sdk.key"
                android:value="\${applovinKey}"
                tools:node="merge"
                tools:replace="android:value" />
    
            <!-- 集成flurry数据上报，无则改成 `tools:node="remove"`以便编译时移除 -->
            <meta-data
                android:name="flurry.sdk.API_KEY"
                android:value="\${flurryApiKey}"
                tools:node="merge"
                tools:replace="android:value" />
    
        </application>
    ```