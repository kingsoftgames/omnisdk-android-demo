

# SGSDK Android 接入指南
<!-- TOC -->

- [注意事项](#注意事项)
- [版本更新说明](#版本更新说明)
- [简介](#简介)
- [术语](#术语)
    - [广告功能模式](#广告功能模式)
    - [名词解释](#名词解释)
- [SGSDK 版本升级指南](#sgsdk-版本升级指南)
- [接入指南](#接入指南)
    - [1. 准备工作](#1-准备工作)
    - [2. 搭建开发环境](#2-搭建开发环境)
        - [2.1 运行 SGSDK demo](#21-运行-sgsdk-demo)
        - [2.2 构建您的 Android studio 项目（如有需要）](#22-构建您的-android-studio-项目如有需要)
        - [2.3 拷贝 SGSDK 配置文件及参数配置文件](#23-拷贝-sgsdk-配置文件及参数配置文件)
    - [3. Application 设置](#3-application-设置)
    - [4. 接入生命周期接口](#4-接入生命周期接口)
    - [5. 基础功能 API 使用说明](#5-基础功能-api-使用说明)
        - [5.1 用户接口](#51-用户接口)
            - [5.1.1 初始化及登录回调接口接入](#511-初始化及登录回调接口接入)
            - [5.1.2 登录接口](#512-登录接口)
            - [5.1.3 登出接口](#513-登出接口)
            - [5.1.4 切换账号接口](#514-切换账号接口)
            - [5.1.5 退出接口](#515-退出接口)
            - [5.1.6 释放资源接口（必接）](#516-释放资源接口必接)
        - [5.2 充值接口](#52-充值接口)
            - [5.2.1 支付接口](#521-支付接口)
            - [5.2.2 支付回调](#522-支付回调)
        - [5.3 渠道统计接口](#53-渠道统计接口)
            - [5.3.1 创建角色](#531-创建角色)
            - [5.3.2 角色升级](#532-角色升级)
            - [5.3.3 进入游戏](#533-进入游戏)
        - [5.4 扩展接口](#54-扩展接口)
            - [5.4.1 任务开始](#541-任务开始)
            - [5.4.2 任务成功](#542-任务成功)
            - [5.4.3 任务失败](#543-任务失败)
            - [5.4.4 打开 webview （打开活动页、问卷调查等）](#544-打开-webview-打开活动页问卷调查等)
            - [5.4.5 通用接口](#545-通用接口)
            - [5.4.6 获取渠道 ID 接口](#546-获取渠道-id-接口)
    - [6. ~~广告流量变现接入说明~~](#6-广告流量变现接入说明)
        - [6.1 SGSDK 中聚合广告接入准备工作](#61-sgsdk-中聚合广告接入准备工作)
            - [6.1.1 获取必要的广告配置信息](#611-获取必要的广告配置信息)
            - [6.1.2 配置 Manifest 文件](#612-配置-manifest-文件)
        - [6.2 接口介绍](#62-接口介绍)
            - [6.2.1 插屏广告](#621-插屏广告)
            - [6.2.2 Banner 广告](#622-banner-广告)
            - [6.2.3 激励广告](#623-激励广告)
        - [6.3 ~~加载广告回调说明~~ (已废弃)](#63-加载广告回调说明-已废弃)
        - [6.4 展示广告 回调说明](#64-展示广告-回调说明)
        - [6.5 添加测试设备接口](#65-添加测试设备接口)
- [混淆规则](#混淆规则)
- [渠道接入特殊说明](#渠道接入特殊说明)
    - [金山世游海外官网渠道接入](#金山世游海外官网渠道接入)
        - [直接使用具体登录方式登录说明](#直接使用具体登录方式登录说明)
        - [接入 Facebook 登录](#接入-facebook-登录)
            - [关于 Facebook 登录切换账号问题的解释及操作教程](#关于-facebook-登录切换账号问题的解释及操作教程)
        - [接入 Google 登录](#接入-google-登录)
        - [额外接口介绍](#额外接口介绍)
            - [1、关联账号](#1关联账号)
            - [接口说明](#接口说明)
            - [接口方法](#接口方法)
            - [2、打开用户中心](#2打开用户中心)
            - [接口说明](#接口说明-1)
            - [接口方法及参数说明](#接口方法及参数说明)
            - [3、Facebook 分享](#3facebook-分享)
            - [shareInfo 参数说明：](#shareinfo-参数说明)
            - [返回结果错误码如下：](#返回结果错误码如下)
            - [4、facebook 请求](#4facebook-请求)
            - [接口说明](#接口说明-2)
            - [5、打开通用的 web 页](#5打开通用的-web-页)
            - [6、通用接口](#6通用接口)
        - [官网可调用方法](#官网可调用方法)
            - [1、绑定提示页](#1绑定提示页)
            - [2、多应用链接（图片）分享](#2多应用链接图片分享)
            - [3、打开客服](#3打开客服)
            - [4、跳转客服邮箱](#4跳转客服邮箱)
            - [5、获取客服新消息数量](#5获取客服新消息数量)
            - [6、获取公告配置消息](#6获取公告配置消息)
            - [7、打开商店评分框](#7打开商店评分框)
            - [8、获取第三方社交信息](#8获取第三方社交信息)
            - [9、获取第三方好友信息](#9获取第三方好友信息)
    - [茄子渠道接入特殊说明](#茄子渠道接入特殊说明)
        - [版本变更说明及渠道文档](#版本变更说明及渠道文档)
        - [茄子渠道 1.8.0.1 升级问题注意](#茄子渠道-1801-升级问题注意)
        - [茄子 SDK 官方文档](#茄子-sdk-官方文档)
        - [渠道名称](#渠道名称)
        - [依赖库说明](#依赖库说明)
        - [广告接口特殊说明](#广告接口特殊说明)
        - [callmethod 动态调用接口说明](#callmethod-动态调用接口说明)
        - [打开商店评分框](#打开商店评分框)
        - [AndroidManifest 文件配置说明](#androidmanifest-文件配置说明)
    - [Jio渠道接入特殊说明](#jio渠道接入特殊说明)
    - [IMO 渠道接入特殊说明](#imo-渠道接入特殊说明)
        - [分享接口](#分享接口)
    - [华为 渠道接入特殊说明](#华为-渠道接入特殊说明)
        - [增加依赖配置](#增加依赖配置)
- [Q&A](#Q&A)

<!-- /TOC -->

## 注意事项

1. 请使用 **Android Studio** 开发工具接入 SGSDK 。

   建议使用最新版本的 Android Studio，以及下面的编译配置：
   ```groovy
   // ./app/build.gradle
   android {
       defaultConfig {
           targetSDKVersion = 29
       }
   }
   ```
   ```groovy
   // ./build.gradle
   classpath 'com.android.tools.build:gradle:3.6.3'
   ```
   ```properties
   # ./gradle/wrapper/gradle-wrapper.properties
   distributionUrl=https\://services.gradle.org/distributions/gradle-5.6.4-all.zip
   ```
   
   > google 要求 2020-11-02起 [适配](https://developer.android.com/distribute/best-practices/develop/target-sdk) targetSDKVersion = 29

2. **注意：**由于 Google 政策表明在收集广告id的同时不可收集 IMEI、Android id 等其他硬件设备标识，否则有被警告下架风险，请**自行检查游戏程序及游戏使用的其他三方 SDK 是否获取了IMEI并申请相关权限，请尽量避免获取IMEI及申请 READ_PHONE_STATE 权限**。

3. SGSDK 是一个聚合版的 SDK ，接入渠道 SDK 不同，接入方式会有稍许差异，接入前请仔细阅读本文档中“**[渠道接入特殊说明](#渠道接入特殊说明)**”章节的内容。
4. SGSDK 目前最低支持版本为 `API 19: Android 4.4`。

## 版本更新说明

**v1.1.0 2020.12.29**

1. 优化官网渠道包 google 支付功能，指定方式登录功能
2. 废弃调官网渠道中的“打开客户”，“跳转客服邮箱”，“获取客服新消息数量”，“获取公告配置消息”接口

**v1.0.8 2020.10.22**
1. 新 IMO 渠道功能接入
2. 移除 admob，使用 adworks替换广告功能
3. 增加华为国内渠道

**v1.0.7.3 2020.09.10**

1. 优化编译插件，详细阅读 [SGSDK 版本升级指南](#SGSDK 版本升级指南)
2. 其他优化

**v1.0.6.1007 2020.08.03**

1. 使用全新的依赖接入方式

**v1.0.6 2020.07.07**

1. 新增通用打开 web 网页接口，可用于打开调查问卷、活动页等。**接口详见：接口介绍-扩展接口 5.7 打开webview**

**v1.0.5 2020.06.01**

1. 增加获取第三方（facebook）渠道头像，性别信息。**接口详见海外官网渠道 接入-官网可调用方法-8、获取第三方社交信息**
2. 修复 分享信息 sharetype 字段错误。

**v1.0.4 2020.05.22**

1. 分享接口新增 `type`属性。
2. 官网包& facebook 功能渠道分享新增默认分享文本。
3. 修复部分设备 无法获取设备ID 问题

**v1.0.3**

1. 调试优化各渠道

**v1.0.2**

1.增加了日志上报模块,需要在配置文件中增加SgDataReportUrl参数配置

SgDataReportUrl=https://api.sgsdk.com/loggy/v1/GetUploadURL

**v1.0.1**

发布日期 2020-04-20

1.在更改广告接口中的 show 方法以及 hide 方法加入 adId 参数

2.加入了相关广告缓存的内容

3.将配置参数  SgHwAppId (平台id) ， SgHwAdConfigUr (海外平台配置信息地址) 改为 SgAppId 和 SgSafeApi

4.增加 loadRewardAd(Context context, String adId) 方法

**v1.0.0**

发布日期 2020-04-17

1.抽离出广告模

## 简介

金山世游 SGSDK Android 是一个聚合平台的 SDK，提供了登录，支付，广告流量变现，等相关功能模块。

## 术语

### 广告功能模式

1. 聚合广告 SDK

   联系 Adworks 广告组。

2. 渠道广告 SDK

   即调用的广告接口，内部执行代码逻辑是由接入渠道 SDK 所提供。

### 名词解释

1. CP 

   CP 方指游戏厂商，本文档中特指游戏研发。

2. 发行商平台

   发行商平台即 SGSDK 的提供方

3. AdWorks

   AdWorks 是金山世游新提供的广告 SDK。

4. 渠道

   提供游戏下载和更新的地方。比如小米，华为，茄子，传音，google 等。

## SGSDK 版本升级指南
> 接入、升级，请阅读对应版本的编译配置、升级注意事项。

请阅读 [SGSDK Android 版本升级指南](sgsdk/client/升级指南.md)

## 接入指南

> **本节为 SGSDK 开发工具的新手使用教程，只涉及教授 SDK 的使用方法，默认读者已经熟悉 IDE 的基本使用方法（Android Studio），以及具有一定的编程知识基础等。**

### 1. 准备工作

1. 联系发行商平台获取需要接入的模块表。

2. 联系发行商平台获取 SDK 及 SDK 相关 zip 文件，zip 内容结构如下:
  
    ``` java
    +--- sgsdk-android.zip
    |    \--- sdk_gradle_file
    |         +--- app
    |              +--- src/main/assets/sgsdk_config.properties // 参数配置文件
    |              +--- src/main/assets/sgsdk_project_config.properties // 模块加载配置文件
    |              +--- build.gradle      // SDK 基本依赖配置
    |              +--- kssgconfig.gradle // SDK 依赖配置文件
    |         +--- build.gradle
    |         +--- settings.gradle
    |    \--- sgsdk-android-demo.apk // demo apk
    |    \--- sgsdk-android-demo.zip // demo 源码
    |    \--- sgsdk_android_docs.md  // 接入文档
    ```

### 2. 搭建开发环境

#### 2.1 运行 SGSDK demo

Android Studio | File | Open | （sgsdk-android-demo.zip 解压目录）

#### 2.2 构建您的 Android studio 项目（如有需要）

1)、前往 Android Studio | New Project（新项目）| Minimum SDK（最低 SDK）

2)、选择 `API 19: Android 4.4` 或更高版本，然后创建新项目。

#### 2.3 拷贝 SGSDK 配置文件及参数配置文件

1. 按目录结构，将 `sgsdk-android-zip/sdk_gradle_file` 下的文件对应目录结构，拷贝到项目工程或**合并**到引擎生成的对应文件内。
2. `kssgconfig.gradle`、`*.properties` 拷贝时保持对应的目录结构。

完成以上操作后同步代码（点击`sync now`）.
> 细节请阅读 [SGSDK 版本升级指南](#SGSDK-版本升级指南)

### 3. Application 设置

在 AndroidManifest.xml 文件中，设置 Application 为 SGApplication。

修改的代码如下：
```xml
<application
     android:name="com.sgsdk.client.api.SGApplication"
     android:label="@string/app_name"
     tools:replace="android:name">
```

如果游戏有自己的 Application，则需要继承 SGApplication。

如果 CP 自己已有 Application 并且已继承其它的 Application 类，则可以通过如下方式进行替代接入：

```java
public class SGApplication extends Application {

    @Override
    public void onCreate() {
        super.onCreate();
        SGSDK.getInstance().onApplicationCreate(this);
    }

    @Override
    protected void attachBaseContext(Context base) {
        super.attachBaseContext(base);
        SGSDK.getInstance().onApplicationAttachBaseContext(base);
    }

    @Override
    public void onTerminate() {
        super.onTerminate();
        SGSDK.getInstance().onApplicationTerminate(getApplicationContext());
    }
}
```

### 4. 接入生命周期接口

在主 Activity 中接入如下生命周期方法，代码示例如下：

```java
@Override
 protected void onCreate(Bundle savedInstanceState) {
     super.onCreate(savedInstanceState);       
     SGSDK.getInstance().onCreate(this, savedInstanceState);
}
@Override
public void onActivityResult(int requestCode, int resultCode, Intent data) {
		super.onActivityResult(requestCode, resultCode, data);
		SGSDK.getInstance().onActivityResult(this, requestCode, resultCode, data);
}
@Override
public void onSaveInstanceState(Bundle state) {
		super.onSaveInstanceState(state);
		SGSDK.getInstance().onSaveInstanceState(this, outState);
}

@Override
public void onRestoreInstanceState(Bundle savedInstanceState) {
    super.onRestoreInstanceState(savedInstanceState);
    SGSDK.getInstance().onRestoreInstanceState(this,savedInstanceState);
}

@Override
public void onConfigurationChanged(Configuration newConfig) {
		super.onConfigurationChanged(newConfig);
		SGSDK.getInstance().onConfigurationChanged(this, newConfig);
}

@Override
protected void onNewIntent(Intent intent) {
		super.onNewIntent(intent);
		SGSDK.getInstance().onNewIntent(this, intent);
}

@Override
public void onDestroy() {
		super.onDestroy();
		SGSDK.getInstance().onDestroy(this);
}
@Override
public void onStop() {
		super.onStop();
		SGSDK.getInstance().onStop(this);
}
@Override
public void onStart() {
		super.onStart();
		SGSDK.getInstance().onStart(this);
}

@Override
protected void onRestart() {
    super.onRestart();
    SGSDK.getInstance().onRestart(this);
}

@Override
public void onResume() {
		super.onResume(); //涉及权限申请，必须重写
		SGSDK.getInstance().onResume(this);
}
@Override
public void onPause() {
		super.onPause();
		SGSDK.getInstance().onPause(this);
}

@Override
public void onBackPressed() {
	super.onBackPressed();
	SGSDK.getInstance().onBackPressed(this);
}

@Override
public void onRequestPermissionsResult(int requestCode,
		String[] permissions, int[] grantResults) {
		super.onRequestPermissionsResult(requestCode, permissions, grantResults);
		SGSDK.getInstance().onRequestPermissionsResult(this, requestCode, permissions, grantResults);
}
```

**<font color=red>onCreate 生命周期方法比较特殊。</font>**

```java
@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    SGSDK.getInstance().onCreate(this, savedInstanceState);
    SGSDK.getInstance().setUserCallBack(new UserCallBack() {})；
}
```

<font color=red>SGSDK.getInstance().setUserCallBack(new UserCallBack() {})；
以上代码的表示的意思是实现一个匿名的 UserCallBack 对象，该对象中实现了初始化失败，初始化成功，登录成功、登录失败、登录取消，登出完成</font>

### 5. 基础功能 API 使用说明

#### 5.1 用户接口

##### 5.1.1 初始化及登录回调接口接入

**应用场景**

当前接口必须在 onCreate 生命周期中调用，在 UserCallBack 中实现登录 callback 接口（登录成功、失败、取消，登出成功、失败，初始化失败接口）
例如登录成功，游戏在此回调中实现登录成功后的逻辑,其余的 callback 接口类似。
注：在登录成功 callback 中，调用 SGSDK 的 onEnterGame 接口。

**方法定义**

```java
public void setUserCallBack(UserCallBack userCallBack)
```

**参数说明**

- 输入参数说明：

  | 参数         | 说明                                       |
  | ------------ | ------------------------------------------ |
  | userCallBack | 登录以及初始化回调接口UserCallBack类说明： |

- UserCallBack 接口说明：

  | 方法名称       | 说明                                                         |
  | -------------- | ------------------------------------------------------------ |
  | onLoginSuccess | 登录成功回调，code：状态码， authInfo：详见下文 [authInfo 数据说明](#authinfo) |
  | onLoginFail    | 登录失败回调，code：状态码，msg：失败提示信息，channelCode：具体渠道出错错误码 |
  | onLoginCancel  | 登录取消回调，code：状态码，msg：取消提示信息                |
  | onLogoutFinish | 登出成功，需要退出当前游戏账号，并返回游戏登录首页<br>code：状态码，msg：登出提示信息 |
  | onInitSuccess  | 初始化成功，可以进行下一步操作，如登录等<br>code：状态码，msg：初始化提示信息，channelCode：具体渠道返回状态码 |
  | onInitFail     | 初始化失败，请提示玩家初始化失败，建议退出游戏后重新进入<br>code：状态码，msg：初始化失败提示信息，channelCode：具体渠道返回状态码 |

  ### <a id="authinfo">authInfo 数据说明</a>

  登录成功回调 authInfo 参数为一个 base64 编码的字符串，解码之后格为

  ```json
  {"uid":"","token":"","showName":"","channel_id":"","certification":"","isRelated":"","ext":""}
  ```

  | 名称          | 描述                                                         |
  | ------------- | ------------------------------------------------------------ |
  | uid           | 平台 uid                                                     |
  | token         | 平台用户 token                                               |
  | showName      | 用户名，空值此渠道无用户名                                   |
  | channel_id    | 渠道 ID                                                      |
  | certification | 实名制及是否成年状态： -1 渠道实现防沉迷 ；0 未实名制 ；<br>1 未成年； 2 已成年；空值:该应用及渠道无实名信息 |
  | isRelated     | true 表示为非纯游客，false 表示为纯游客，为空账号类型未知    |
  | ext           | 扩展参数                                                     |

  **关于 ext 参数说明：**

  1. 目前只有 facebook 登录和 Google 登录有额外的渠道信息参数。
  2. 性别信息根据是否授权决定是否能获取到，如未授权，则为 null。
  3. ext 是一个 JOSNObeject。

  | 名称     | 描述                                                         |
  | -------- | ------------------------------------------------------------ |
  | imageUrl | 平台头像路径                                                 |
  | gender   | 性别，返回 female or male ；如是其他信息则表示用户未设置性别 |
  | nickName | 第三方渠道昵称                                               |
  | width    | 头像的宽度（如有，无则是 0 ）                                |
  | height   | 头像的高度（如有，无则是 0 ）                                |

**代码示例**

```java
SGSDK.getInstance().setUserCallBack(new UserCallBack() {

    @Override
    public void onLoginSuccess(int code, String authInfo) {
      //登录成功
    }

    @Override
    public void onLoginFail(int code, String msg, String channelCode) {
      //登录失败
    }

    @Override
    public void onLoginCancel(int code, String msg) {
      //登录取消
    }

    @Override
    public void onLogoutFinish(int code, String msg)  {
      //登出成功，需要退出当前游戏账号，并返回游戏登录首页

    }

    @Override
    public void onInitSuccess(int code, String msg, String channelCode) {
      //初始化成功，可以进行下一步操作，如登录等
    }

    @Override
    public void onInitFail(int code, String msg, String channelCode) {
      //初始化失败，请提示玩家初始化失败，建议退出游戏后重新进入
    }
});
```

##### 5.1.2 登录接口

**应用场景**

此接用来调起 SDK 登录界面，一般在刚启动应用后调用此方法。

**方法定义**

```java
public void login(final Activity activity, final String customParams)
```


**参数说明**

- 输入参数说明

| 参数         | 说明                                                         |
| ------------ | ------------------------------------------------------------ |
| customParams | 该参数用于扩展，传输时使用 json 格式，接入时若不需要直接置空即可 |

**代码示例**

```java
SGSDK.getInstance().login(MainActivity.this, "");
```

##### 5.1.3 登出接口

**应用场景**

此接口可以提供一个按钮让用户主动触发调用，一般用来注销当前所登录的账号。登出回调接口在 UserCallBack 中的 onLogoutFinish 方法中进行通知。

**方法定义**

```java
public void logout(Activity activity, String customParams)
```

**参数说明**

- 输入参数说明

| 参数         | 说明                                                         |
| ------------ | ------------------------------------------------------------ |
| Activity     | 当前活跃的Activity                                           |
| customParams | 该参数用于扩展，传输时使用 json 格式，接入时若不需要直接置空即可 |

**代码示例**

```java
SGSDK.getInstance().logout(MainActivity.this, "");
```

##### 5.1.4 切换账号接口

**应用场景**

此接口只部分渠道有效，如果渠道没有实现，则内部逻辑用 logout 接口实现；切换账号回调接口在 UserCallBack 中的 onLogoutFinish 方法中进行通知。

**方法定义**

```java
public void switchAccount(Activity activity, String customParams)
```

**参数说明**

- 输入参数说明


| 参数         | 说明                                                         |
| ------------ | ------------------------------------------------------------ |
| Activity     | 当前活跃的Activity                                           |
| customParams | 该参数用于扩展，传输时使用 json 格式，接入时若不需要直接置空即可 |

**代码示例**

```java
SGSDK.getInstance().switchAccount(MainActivity.this, "");
```

##### 5.1.5 退出接口

**应用场景** 

拉起退出界面（如果渠道有退出界面，会调用渠道的退出界面）。

**方法定义**

```java
public void exit(Activity activity, ExitCallBack exitCallBack, String customParams)
```

**参数说明**

- 输入参数说明

| 参数         | 说明                                                         |
| ------------ | ------------------------------------------------------------ |
| Activity     | 当前活跃的Activity                                           |
| exitCallBack | 退出回调，详见 ExitCallBack接口类说明                        |
| customParams | 该参数用于扩展，传输时使用 json 格式，接入时若不需要直接置空即可 |

- ExitCallBack接口类说明

  ```java
  new ExitCallBack() {
      @Override
    public void onNoChannelExiter(){
      //未提供退出引导
      //1 游戏需要使用自己的退出引导，进行退出
      注意：在最终退出前，需要先调用SGSDK的回收资源接口}
  
    @Override
    public void doExit() {
      //已提供退出引导，游戏不需要使用自己的退出引导
      //1 调用SGDSK的回收资源接口
      //2 释放游戏资源 并退出游戏
  
    }
  }
  ```

  

**代码示例**

```java
SGSDK.getInstance().exit(activity, new ExitCallBack() {
    @Override
    public void onNoChannelExiter() {
        Dialog dialog = new AlertDialog.Builder(activity).setTitle("退出游戏").setCancelable(false).setMessage("您确定要退出游戏吗？").setPositiveButton("确定", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {
                dialog.dismiss();
                SGLog.d("onNoChannelExiter exit dialog 00");
                SGSDK.getInstance().releaseResource(activity, "");
                activity.finish();
                System.exit(0);
            }
        }).setNegativeButton("取消", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {
                dialog.dismiss();
            }
        }).create();
        dialog.show();
    }

    @Override
    public void doExit() {
        SGLog.d("doExit exit 0");
        activity.finish();
        SGSDK.getInstance().releaseResource(activity, "");
        System.exit(0);
    }
}, null);
```

##### 5.1.6 释放资源接口（必接）

**应用场景**

游戏在真正退出前，调用此接口释放渠道资源。

**方法定义**

```java
public void releaseResource(Activity activity, String customParams);
```

**参数说明**

- 传入参数说明

| 参数         | 说明                                                         |
| ------------ | ------------------------------------------------------------ |
| Activity     | 游戏主 Activity                                              |
| customParams | 该参数用于扩展，传输时使用 json 格式，接入时若不需要直接置空即可 |

**代码示例**

```java
SGSDK.getInstance().releaseResource(activity, "");
```

#### 5.2 充值接口

##### 5.2.1 支付接口

**应用场景**

调用此接口会拉起的渠道的支付界面进行付费操作。

**方法定义**

```java
public void pay(Activity activity, PayInfo payInfo,PayCallBack payCallBack)
```

**参数说明**

- 输入参数说明

| 参数        | 说明                                      |
| ----------- | ----------------------------------------- |
| Activity    | 当前活跃的Activity                        |
| payInfo     | 支付信息对象，包含产品 ID、名称和数量等   |
| paycallback | 支付回调接口，详见 5.2.2 支付回调接口说明 |

- 关于 PayInfo 的成员说明


<font color=red>所有必须字段必须进行接入，否则会导致部分渠道无法支付！</font>

**请严格按照 SGSDK 规定的字段长度进行设置，否则可能发生游戏服务器端长度不够问题。**

| 参数                   | 参数类型 | 最大长度 | 说明                                                         | 必须 |
| ---------------------- | -------- | -------- | ------------------------------------------------------------ | ---- |
| uid                    | String   | 128      | 用户 ID,游戏必须使用登录时金山世游服务器返回的 uid           | Y    |
| productId              | String   | 64       | 商品 ID                                                      | Y    |
| productName            | String   | 64       | 商品名称                                                     | Y    |
| productDesc            | String   | 128      | 商品描述                                                     | Y    |
| productUnit            | String   | 64       | 商品单位，例如元宝                                           | Y    |
| productUnitPrice       | double   | 10       | 商品单价,单位元                                              | N    |
| productQuantity        | int      | 10       | 产品数量，例如购买 60 元宝则传 60                            | N    |
| totalAmount            | double   | 10       | 商品总金额,单位元                                            | N    |
| payAmount              | double   | 10       | 实际支付总额,单位元                                          | N    |
| currencyName           | String   | 64       | 实际支付的国际标准货币代码，比如CNY(人民币)/USD(美元); 海外官网渠道非必须 | Y    |
| roleId                 | String   | 32       | 角色 ID                                                      | Y    |
| roleName               | String   | 64       | 角色名称                                                     | Y    |
| roleLevel              | int      | 32       | 角色等级                                                     | Y    |
| roleVipLevel           | String   | 32       | 角色 vip 等级                                                | Y    |
| serverId               | String   | 32       | 服 ID：必须为纯数字，且不能超过2147483647（应用宝渠道要求）  | Y    |
| zoneId                 | String   | 32       | 区 ID                                                        | Y    |
| partyName              | String   | 32       | 帮会名称                                                     | N    |
| virtualCurrencyBalance | String   |          | 虚拟货币余额                                                 | N    |
| customInfo             | String   | 2000     | 扩展字段，订单支付成功后，透传给游戏                         | N    |
| gameTradeNo            | String   | 64       | 游戏订单 ID，支付成功后，透传给游戏                          | N    |
| gameCallbackUrl        | String   | 128      | 支付回调地址，如果为空，则后台配置的回调地址                 | N    |
| additionalParams       | String   |          | 扩展参数                                                     | N    |

- 常用的国际货币


| 国家 | 货币中文名 | 货币英文名   | 货币代码 |
| ---- | ---------- | ------------ | -------- |
| 中国 | 人民币元   | RenminbiYuan | CNY      |
| 韩国 | 韩圆       | Korean Won   | KRW      |
| 日本 | 日元       | Japanese Yen | JPY      |
| 美国 | 美元       | U.S.Dollar   | USD      |

**代码示例**

```java
//payInfo 初始化
payment.setTotalPrice(totalPrice);
payment.setProductUnitPrice(1);
SGSDK.getInstance().pay(MainActivity.this, payment, new PayCallBack() {})
```



**支付场景**

场景一： 某个玩家，购买 750 钻石（价值 80 元），创建订单参数是：

| 名称                              | 值      |
| --------------------------------- | ------- |
| productId                         | 11111   |
| payAmount 实际支付总额(单位元)    | 80.0    |
| totalAmount 商品总金额(单位元)    | 80.0    |
| productName 商品名称              | 750钻石 |
| productQuantity 商品数量          | 750     |
| productUnit 商品单位              | 钻石    |
| productUnitPrice 商品单价(单位元) | 无需传  |

场景二： 某个玩家，遇到商品打折优惠：购买 750 钻石（价值 80 元）可享受 8.5 折优惠，这样其实玩家是用 68 元购买了 750 钻石，创建订单参数是：

| 名称                              |                 |
| --------------------------------- | --------------- |
| productId                         | 222             |
| payAmount 实际支付总额(单位元)    | 68.0            |
| totalAmount 商品总金额(单位元)    | 80.0 (折前原价) |
| productName 商品名称              | 750 钻石        |
| productQuantity 商品数量          | 750             |
| productUnit 商品单位              | 钻石            |
| productUnitPrice 商品单价(单位元) | 无需传          |

场景三： 某个玩家，购买月卡（价值 30 元），创建订单参数是：

| productId                         | 333    |
| --------------------------------- | ------ |
| payAmount 实际支付总额(单位元)    | 30.0   |
| totalAmount 商品总金额(单位元)    | 30.0   |
| productName 商品名称              | 月卡   |
| productQuantity 商品数量          | 1      |
| productUnit 商品单位              | 月卡   |
| productUnitPrice 商品单价(单位元) | 无需传 |



##### 5.2.2 支付回调

**应用场景**

在调用 pay 接口时，需要实现 pay 支付 callback (支付的四种状态：支付成功，支付失败，支付取消,支付其他状态）。

**代码示例**

```java
 SGSDK.getInstance().pay(MainActivity.this, payment, new PayCallBack() {

        @Override
        public void onPaySuccess(PayInfo payInfo,PayResult payResult) {
            ToastUtil.showToastLong(MainActivity.this, "pay success, result is "+payResult.toJson());
            OrderUtils.storeOrder(MainActivity.this, GameInfo.getInstance().getUid(),payResult.getXgTradeNo(),payment);
        }

        @Override
        public void onPayFail(PayInfo payInfo,PayResult payResult) {
            ToastUtil.showToastLong(MainActivity.this, "pay failed, result is "+payResult.toJson());
        }

        @Override
        public void onPayCancel(PayInfo payInfo,PayResult payResult) {
            ToastUtil.showToastLong(MainActivity.this, "pay canceled, result is "+payResult.toJson());
        }

        @Override
        public void onPayOthers(PayInfo payInfo, PayResult payResult) {
            ToastUtil.showToastLong(MainActivity.this, "onPayOthers, result is "+payResult.toJson());
        }

        @Override
        public void onPayProgress(PayInfo payInfo, PayResult payResult) {
            ToastUtil.showToastLong(MainActivity.this, "onPayProgress, result is "+payResult.toJson());
        }
    });
```

**参数说明** 

- PayResult 说明

| 名称        | 类型   | 说明                                 |
| ----------- | ------ | ------------------------------------ |
| code        | int    | 支付结果状态码，详见支付状态码说明表 |
| msg         | String | 错误消息                             |
| gameTradeNo | String | 游戏传入的订单号                     |
| sgTradeNo   | String | SG创建的支付订单号                   |
| channelCode | String | 渠道支付结果                         |
| channelMsg  | String | 渠道支付消息                         |

- 支付状态码说明


| code | 解释                                                         |
| ---- | ------------------------------------------------------------ |
| 200  | 支付成功                                                     |
| 2000 | 支付失败                                                     |
| 2010 | 支付失败，出错在创建订单那一步                               |
| 8010 | <font color=red>支付失败，出错在此渠道不支持传入的商品信息<br>（如果收到此错误码有可能是用户设备所属的国家不支持此商品）</font> |
| 2080 | 支付进行中                                                   |
| 2100 | 支付取消                                                     |

#### 5.3 渠道统计接口

##### 5.3.1 创建角色

**应用场景**

游戏在完成创建角色信息后，调用此接口传入角色信息。

**方法定义**

```java
public void onCreateRole(RoleInfo roleInfo)
```

**参数说明**

- 传入参数说明

| 参数     | 说明     |
| -------- | -------- |
| roleInfo | 角色信息 |

- 关于 RoleInfo 的成员说明


所有必接字段必须进行接入，否则会导致统计不完全，部分渠道审核无法通过！

**请严格按照 SGSDK 规定的字段长度进行设置，否则可能发生游戏服务器端长度不够问题。**

| 参数           | 参数类型 | 最大长度                  | 说明                                                         | 必须 |
| -------------- | -------- | ------------------------- | ------------------------------------------------------------ | ---- |
| uid            | string   | 128                       | 用户 ID, 游戏必须使用登录时 SGSDK 返回的 uid                 | Y    |
| serverId       | string   | 32                        | 服 ID：必须为纯数字，且不能超过 2147483647（应用宝渠道要求） | Y    |
| serverName     | string   | 64                        | 游戏必须传入真实的游戏服名称,建议中文                        | Y    |
| zoneId         | string   | 32                        | 游戏区 ID                                                    | Y    |
| zoneName       | string   | 64                        | 游戏大区名称：要与界面显示名称一致，如：界面显示（一区 桃园结义），zoneName 也必须传（一区 桃园结义），UC 渠道要求必传真实值，否则无法通过审核 | Y    |
| roleId         | string   | 32                        | 角色 ID                                                      | Y    |
| roleName       | string   | 64                        | 角色名                                                       | Y    |
| roleType       | string   | 20                        | 角色类型，如法师，道士，战士                                 | N    |
| roleCreateTime | string   | 10                        | 角色创建时间（Unix 时间戳，单位秒），如：1461722392，UC 渠道要求必传真实值，否则无法通过审核 | Y    |
| roleLevel      | int      | 32                        | 角色等级,游戏必须传入真实的角色等级                          | Y    |
| roleVipLevel   | int      | 32                        | 角色 vip 等级                                                | N    |
| partyName      | string   | 32                        | 公会名                                                       | N    |
| gender         | string   | 枚举值：m,f；分别代表男女 | 角色性别                                                     | N    |
| balance        | string   | 128                       | 角色账户余额                                                 | N    |

**代码示例**

```java
findViewById(RUtil.getId(getApplicationContext(), "xg_create_role"))
            .setOnClickListener(new OnClickListener() {
                @Override
                public void onClick(View v) {
                    mRoleInfo.setRoleId("1112");
                    mRoleInfo.setRoleName("cuizi");
                    ...
                    SGSDK.getInstance().onCreateRole(MainActivity.this,
                            mRoleInfo);
                }
            });
```



##### 5.3.2 角色升级

**应用场景**

角色等级接口，角色等级提升时调用

**方法定义**

```java
public void onRoleLevelup(RoleInfo roleInfo)
```

**参数说明**

- 传入参数说明

| 参数     | 说明     |
| -------- | -------- |
| roleInfo | 角色信息 |

**代码示例**

```java
findViewById(RUtil.getId(getApplicationContext(), "xg_role_levelup"))
            .setOnClickListener(new OnClickListener() {

                @Override
                public void onClick(View v) {
                    mRoleInfo.setRoleId("1112");
                    mRoleInfo.setLevel(2);
                    ...
                    SGSDK.getInstance().onRoleLevelup(mRoleInfo);
                }
            });
```



##### 5.3.3 进入游戏

**应用场景**

方法建议在所有的用户角色信息都获取到以后再进行调用

**方法定义**

```java
public void onEnterGame(RoleInfo roleInfo)
```

**参数说明**

- 传入参数说明

| 参数     | 说明     |
| -------- | -------- |
| RoleInfo | 角色信息 |

**代码示例**

```java
SGSDK.getInstance().onEnterGame(mRoleInfo)
```

<!-- 以下接口暂时不对CP开放 -->

<!-- ##### 4.4 自定义事件上报接口 -->

<!-- 接口定义：public void onEvent(RoleInfo roleInfo, String eventId, String eventDesc, int eventVal, JSONObject eventBody) -->

<!-- 接口说明：自定义事件，传入事件id以及事件内容 -->

<!-- | 参数      | 说明                               | -->
<!-- | --------- | ---------------------------------- | -->
<!-- | roleInfo  | 角色信息                           | -->
<!-- | eventId   | 事件id                             | -->
<!-- | eventDesc | 事件描述                           | -->
<!-- | eventVal  | 事件内容                           | -->
<!-- | eventBody | 事件详细定义，JSON格式，默认为null | -->

#### 5.4 扩展接口

##### 5.4.1 任务开始

**应用场景**

当一个任务开始时调用此方法，进行数据统计；<font color=red>接入茄子渠道时此接口必须接入 </font>

比如说关卡游戏进行某一关卡之后调用此方法

**方法定义**

```java
public void onMissionBegin(RoleInfo roleInfo, String missionId, String missionName, int doMissionTimes, int roleCurrentPower, String customParams);
```

**参数说明**

- 传入参数说明 

| 参数             | 参数类型 | 说明                                                         | 必须 |
| ---------------- | -------- | ------------------------------------------------------------ | ---- |
| roleInfo         | RoleInfo | 对象信息                                                     | N    |
| missionId        | String   | 任务ID                                                       | N    |
| missionName      | String   | 任务名称                                                     | Y    |
| customParams     | String   | 该参数用于扩展，传输时使用json格式，接入时若不需要直接置空即可 | N    |
| doMissionTimes   | int      | 次数，第几次执行该任务/关卡就传几                            | N    |
| roleCurrentPower | int      | 角色当前体力值                                               | N    |

**代码示例**

```java
SGSDK.getInstance().onMissionBegin(null, null, "第一关", 0, 0, "");
```

##### 5.4.2 任务成功

**应用场景**

当一个任务完成时调用此方法，进行数据统计；<font color=red>接入茄子渠道时此接口必须接入 </font>

**方法定义**

```java
public void onMissionSuccess(RoleInfo roleInfo, String missionId, String missionName, int doMissionTimes, int roleCurrentPower, String customParams);
```

**参数说明**

- 传入参数说明

| 参数             | 参数类型 | 说明                                                         | 必须 |
| ---------------- | -------- | ------------------------------------------------------------ | ---- |
| roleInfo         | RoleInfo | 对象信息                                                     | N    |
| missionId        | String   | 任务ID                                                       | N    |
| missionName      | String   | 任务名称                                                     | Y    |
| customParams     | String   | 该参数用于扩展，传输时使用json格式，接入时若不需要直接置空即可 | N    |
| doMissionTimes   | int      | 次数，第几次执行该任务/关卡就传几                            | N    |
| roleCurrentPower | int      | 角色当前体力值                                               | N    |

**代码示例**

```java
SGSDK.getInstance().onMissionSuccess(null, null, "第一关", 0, 0, "");
```

##### 5.4.3 任务失败

**应用场景**

当一个任务执行失败时调用此方法，进行数据统计；<font color=red>接入茄子渠道时此接口必须接入 </font>

**方法定义**

```java
public void onMissionFail(RoleInfo roleInfo, String missionId, String missionName, int doMissionTimes, int roleCurrentPower, String customParams);
```

**参数说明**

- 传入参数说明

| 参数             | 参数类型 | 说明                                                         | 必须 |
| ---------------- | -------- | ------------------------------------------------------------ | ---- |
| roleInfo         | RoleInfo | 对象信息                                                     | N    |
| missionId        | String   | 任务ID                                                       | N    |
| missionName      | String   | 任务名称                                                     | Y    |
| customParams     | String   | 该参数用于扩展，传输时使用json格式，接入时若不需要直接置空即可 | N    |
| doMissionTimes   | int      | 次数，第几次执行该任务/关卡就传几                            | N    |
| roleCurrentPower | int      | 角色当前体力值                                               | N    |

**代码示例**

```java
SGSDK.getInstance().onMissionFail(null, null, "第一关", 0, 0, "");
```

<!-- 以下接口暂时不对CP开放 -->

<!-- ##### 5.4 购买虚拟货币 -->

<!-- 接口定义：public void onVirtualCurrencyPurchase(RoleInfo roleInfo, int amount, String virtualCurrencyType, int virtualCurrencyTotal, String gameTradeNo) -->

<!-- 接口说明：充值获得的虚拟货币 -->

<!-- | 参数                 | 说明                              | -->
<!-- | -------------------- | --------------------------------- | -->
<!-- | roleInfo             | 角色信息                          | -->
<!-- | amount               | 获得数量                          | -->
<!-- | virtualCurrencyType  | 虚拟货币名称，如：元宝、金币等    | -->
<!-- | virtualCurrencyTotal | 虚拟货币总量,如：100、1000、10000 | -->
<!-- | gameTradeNo          | 游戏订单号                        | -->



<!-- ##### 5.5 赠送虚拟货币 -->

<!-- 接口定义：public void onVirtualCurrencyReward(RoleInfo roleInfo, int amount, String virtualCurrencyType, int virtualCurrencyTotal, String gainChannel, String gainChannelType, String gameTradeNo) -->

<!-- 接口说明：玩家可以在任务奖励、登录奖励、成就奖励等环节获得赠送的虚拟货币 -->

<!-- | 参数                 | 说明                                   | -->
<!-- | -------------------- | -------------------------------------- | -->
<!-- | roleInfo             | 角色信息                               | -->
<!-- | amount               | 奖励数量                               | -->
<!-- | virtualCurrencyType  | 虚拟货币名称，如：元宝、金币等         | -->
<!-- | virtualCurrencyTotal | 虚拟货币总量,如：100、1000、10000      | -->
<!-- | gainChannel          | 货币来源，比如（每日登录奖励,抽宝箱等) | -->
<!-- | gainChannelType      | 货币来源类型比如日常任务、闯关等       | -->
<!-- | gameTradeNo          | 游戏订单号                             | -->



<!-- ##### 5.6 消费虚拟货币 -->

<!-- 接口定义：public void onVirtualCurrencyConsume(RoleInfo roleInfo, int amount, String virtualCurrencyType, int virtualCurrencyTotal, String itemName, int itemNum, String itemType) -->

<!-- 接口说明：建议只跟踪有价值的虚拟货币，普通游戏币的消耗不建议在此跟踪 -->

<!-- | 参数                 | 说明                              | -->
<!-- | -------------------- | --------------------------------- | -->
<!-- | roleInfo             | 角色信息                          | -->
<!-- | amount               | 消费虚拟货币数量                  | -->
<!-- | virtualCurrencyType  | 虚拟货币名称，如：元宝、金币等    | -->
<!-- | virtualCurrencyTotal | 虚拟货币总量,如：100、1000、10000 | -->
<!-- | itemName             | 消费项目（比如十连抽，购买体力等) | -->
<!-- | itemNum              | 消费项目的数量,如1、2、3          | -->
<!-- | itemType             | 消费类型 比如道具                 | -->


##### 5.4.4 打开 webview （打开活动页、问卷调查等）

**应用场景**

该接口在应用内打开一个 webview，展示的内容由传入的 url 决定，比如传入 调查问卷的地址，打开的即是问卷调查系统。该接口只返回页面（webview）关闭的回调，其他回调不返回。

**方法定义**

```java
 public void openWebActivity(Activity activity,String url, String customParams)
```

**参数说明**

- 输入参数说明

| 参数         | 类型     | 说明                | 是否必须 |
| ------------ | -------- | ------------------- | -------- |
| activity     | Activity | 打开webview的上下文 | Y        |
| url          | String   | 需要打开的网页地址  | Y        |
| customParams | String   | 透传字段            | N        |

**代码示例**

```java
SGSDK.getInstance().openSGWebActivity(Activity activity,String url, String customParams)
```



##### 5.4.5 通用接口

**应用场景**

通过当前接口，来调用部分 渠道的特殊接口

**方法定义**

```java
callSGMethod(String methodName, Object param, SGGenericCallBack callback, String customInfo)
```

**参数说明**

- 输入参数说明

| 参数       | 说明                             |
| ---------- | -------------------------------- |
| methodName | 特殊接口的方法名                 |
| param      | 调用接口时，所需要的参数         |
| callback   | 回调信息，具体内容按照各接口区分 |
| customInfo | 透传信息，会在回调信息中透传回来 |

- 通用回调接口说明


```java
new SGGenericCallBack() {
  @Override
  public void onSGGenericCallBack(int code, String customInfo, Object result) {
    //code：         返回码，用于判断是否成功
    //customInfo    透传信息，调用通用接口callXGMethod时传入的customInfo
    //result        返回结果
  }
}
```

**代码示例**

```java
SGSDK.getInstance().callSGMethod("getAnnoSetting", "", new SGGenericCallBack() {
    @Override
    public void onSGGenericCallBack(int code, String customInfo, Object result) {
        if (code == SGErrorCode.SUCCESS){
           
        }
    }
},"get anno settings");
```

##### 5.4.6 获取渠道 ID 接口

**应用场景**

获取渠道ID时使用。

**方法定义**

```java
public String getChannelId()
```

**参数说明**

- 返回参数说明

| 参数      | 类型   | 说明   |
| --------- | ------ | ------ |
| channelId | Stirng | 渠道ID |

**代码示例**

```java
SGSDK.getInstance().getChannelId();
```

**现有渠道 channelId 值**

| 渠道名称  | 返回value  |
| --------- | ---------- |
| 茄子      | sunit      |
| 传音      | tecno      |
| 海外 oppo | oppo       |
| 海外 vivo | hwvivo     |
| Jio       | jio        |
| 海外三星  | samsung    |
| 海外gp    | sgoverseas |

### 6. ~~广告流量变现接入说明~~

>废弃：如果需要接入广告请联系 adworks 广告组

~~金山世游 SGSDK 集成了 admob 广告，并通过 admob 中介设置其他渠道广告来源方式集成其他渠道。如果不使用 SGSDK 的单独的广告库，，则忽略6.1中准备工作，直接看6.2部分的接口调用说明~~

#### 6.1 SGSDK 中聚合广告接入准备工作

在 `./app/build.gradle` 添加 `apply from: ("kssgconfig.gradle")` 配置，`kssgconfig.gradle` 内容如下：

```groovy
allprojects {
    repositories {
        maven { url "https://dl.bintray.com/ironsource-mobile/android-sdk" }
        // ironsource 中介功能
        maven { url 'https://dl.bintray.com/ironsource-mobile/android-adapters' }
        maven { url "https://jitpack.io" }

        //金山世游仓库
        maven { url "https://maven.shiyou.kingsoft.com/repository/public/" }
    }
}

dependencies {
    def SGSDK_VERSION = "1.0.6.1003" // 与发行商确认版本号
    api("com.sgsdk.component.plugin:admob:${SGSDK_VERSION}")
}
```

##### 6.1.1 获取必要的广告配置信息
参数值定义在 `sgsdk_config.properties`
1. 获取广告的APPID，和 UnitID，根据不同的广告平台而定，目前是 Admob 广告平台。
确认 `sgsdk_config.properties` 的 `googleAdmobAppid` 值是否存在并正确。
2. 如需接入  Applovin 广告平台，获取 Applovin SDKs Key 。
确认 `sgsdk_config.properties` 的 `applovinKey` 值是否存在并正确。


##### 6.1.2 配置 Manifest 文件

**Admob 与 Applovin 所需要的 manifest 配置已内部集成，只需要确保 `sgsdk_config.properties` 相应参数正确即可。**

> 细节请阅读 [SGSDK 版本升级指南](#SGSDK-版本升级指南)

#### 6.2 接口介绍

根据 Admob 要求，所有接口都需要在主线程调用。

##### 6.2.1 插屏广告

**1、请求加载广告** 

**应用场景**

在需要展示广告地方，需要调用此方法加载广告

**方法定义**

```java
public void loadIntersitalAd(Context context, String unitId)
```

**参数说明**

| 参数    | 描述                                                         | 是否必须 |
| ------- | ------------------------------------------------------------ | -------- |
| context | 上下文<font color=red>（如果使用SGSDK聚合广告，参数需传activity）</font> | Y        |
| adId    | 插屏广告单元ID                                               | Y        |

**代码示例**

```java
SGSDK.getInstance().loadIntersitalAd(this, INTERSITIAL_ID);
```

**2、接收插屏广告的回调**

**应用场景**

设置插屏广告结果通知回调接口，此接口必须在 loadIntersitalAd 方法之前调用

**方法定义**

```java
public void setIntersitalAdCallback(IAdShowListener showListener)
```

**参数说明**

| 描述     | 参数                                                         | 是否必须 |
| -------- | ------------------------------------------------------------ | -------- |
| listener | 插屏广告回调接口，IAdShowListener 详见 6.4 展示广告 回调说明 | Y        |

**代码示例**

```java
SGSDK.getInstance().setIntersitalAdCallback(listener);
```

**3、展示广告**

**应用场景**

调用此方法前，先用 isIntersitalAdReady 方法判断广告广告是准备好，如果有广告，广告将会渲染出来；此方法必须在主线程调用。

**方法定义**

```java
public void showIntersitalAd(Context context, String unitId)
```

**参数说明** 

| 描述    | 参数                                                         | 是否必须 |
| ------- | ------------------------------------------------------------ | -------- |
| context | 上下文<font color=red>（如果使用SGSDK聚合广告，参数需传activity）</font> | Y        |
| unitId  | 插屏广告单元ID                                               | Y        |

**代码示例**

```java
if (SGSDK.getInstance().isIntersitalAdReady(INTERSITIAL_ID,"home")) {
    SGSDK.getInstance().showIntersitalAd(INTERSITIAL_ID);
} else {
    ToastUtil.showNormalToast(this, "intersitial ad is not ready,Please wait for a munite");
    SGSDK.getInstance().loadIntersitalAd(this, INTERSITIAL_ID);
}
```

**4、广告是否已加载完毕**

**应用场景**

在调用展示广告方法前，先调用此方法判断是有准备好的广告

**注：如果所接是<font color=red>茄子渠道</font>,接口调用形式传参为 String adId, String scene**
**特殊场景：如果业务需要循环调用此方法检测广告缓存，或其他方式使用此方法（不是用来展示广告），避免产生不必要的数据，scene 规定为 ShareItAd.LOOP**

**方法定义**

```java
public boolean isIntersitalAdReady(Object... unitId)
```

**参数说明**

- 传入参数说明

| 描述  | 参数                                         | 是否必须 |
| ----- | -------------------------------------------- | -------- |
| adId  | 插屏广告单元ID                               | Y        |
| scene | 广告展示场景（此参数主要是给茄子渠道使用的） | N        |

- 返回值说明

  布尔值：true 表示广告已准备，可以展示，false 表示准备好的广告

**代码示例**

```java
SGSDK.getInstance().isIntersitalAdReady(adId,"scene");
```



##### 6.2.2 Banner 广告

**1、请求广告**

**应用场景**

在需要展示广告地方，需要调用此方法加载广告

**方法定义**

```java
SGSDK.getInstance().loadBannerAd(Activity activity,String adId);
```

**参数说明**

| 参数     | 描述                   | 是否必须 |
| -------- | ---------------------- | -------- |
| activity | 展示当前广告的activity | Y        |
| adId     | banner广告单元ID       | Y        |

**代码示例**

```java
SGSDK.getInstance().loadBannerAd(this, BANNER_ID);
```

**2、设置横幅广告回调**

**应用场景**

设置横幅广告结果通知回调接口，此接口必须在 loadBannerAd 方法之前调用

**方法定义**

```java
 public void setBannerAdCallback(IAdShowListener adCallback)
```

**参数说明**

| 参数     | 描述                                                         | 是否必须 |
| -------- | ------------------------------------------------------------ | -------- |
| listener | 横幅广告回调接口，见 6.4、展示广告 回调说明，此接口需在load广告之前调用(如果接入的是茄子渠道，则不会给banner广告回调，茄子渠道内部会做广告缓存) | Y        |

**代码示例**

```java
SGSDK.getInstance().loadBannerAd(this, BANNER_ID);
```

**3、展示广告**

**应用场景**

调用了 loadBannerAd 方法之后，直接调用此方法等待 banner 广告渲染出来。该接口必须在主线程调用。

**方法定义**

```java
public void showBannerAd(Activity context, String adid, int gravity, ViewGroup container)
```

**参数说明**

| 参数      | 描述                                                       | 是否必须 |
| --------- | ---------------------------------------------------------- | -------- |
| context   | 上下文，是 Activity 类型                                   | Y        |
| adid      | 横幅广告 ID                                                | Y        |
| gravity   | 横幅广告展示的位置，支持：Gravity.TOP/BOTTOM               | Y        |
| container | 加载横幅广告的容器，如果为null 时，默认使用 SDK 创建的容器 | N        |

**代码示例**

```java
SGSDK.getInstance().showBannerAd(this, BANNER_ID, Gravity.BOTTOM, null);
```

**4、隐藏 banner 广告**

**应用场景**

部分广告平台的横幅广告无法关闭，可调用该接口隐藏横幅广告

**方法定义**

```java
public void hideBanner(Activity activity, String adId)
```

**参数说明**

| 参数     | 描述                     | 是否必须 |
| -------- | ------------------------ | -------- |
| Activity | 上下文，是 Activity 类型 | Y        |
| adId     | 横幅广告单元ID           | Y        |

**代码示例**

```java
SGSDK.getInstance().hideBanner(this, BANNER_ID);
```

##### 6.2.3 激励广告

**1、加载视频广告**

**应用场景**

在需要展示广告地方，需要调用此方法加载广告

**方法定义**

```java
public void loadRewardAd(Context context, String adId)
```

**参数说明**

| 参数    | 描述                                                         | 是否必须 |
| ------- | ------------------------------------------------------------ | -------- |
| context | 上下文<font color=red>（如果使用SGSDK聚合广告，参数需传activity）</font> | Y        |
| adId    | 激励广告的单元ID                                             | Y        |

**代码示例**

```java
SGSDK.getInstance().loadRewardAd(this, REWARD_ID);
```

2、设置激励广告回调

**应用场景**

设置激励广告结果通知回调接口，此接口必须在 loadRewardAd 方法之前调用

**方法定义**

```java
public void setRewardAdCallback(IAdShowListener showListener)
```

**参数说明**

| 参数     | 描述                                                         | 是否必须 |
| -------- | ------------------------------------------------------------ | -------- |
| listener | 激励广告回调监听 见 6.4、展示广告 回调说明，此接口需在 load 广告之前调用 | Y        |

**代码示例**

```java
SGSDK.getInstance().setRewardAdCallback(listener);
```

3、展示广告

**应用场景**

调用此方法前，先用 isRewardAdReady 方法判断广告广告是准备好，如果有广告，广告将会渲染出来；此方法必须在主线程调用。

**方法定义**

```java
public void showRewardAd(Context context,String adId)
```

**参数说明**

| 参数    | 描述                                                         | 是否必须 |
| ------- | ------------------------------------------------------------ | -------- |
| Context | 上下文<font color=red>（如果使用 SGSDK 聚合广告，参数需传activity）</font> | Y        |
| adId    | 激励广告单元ID                                               | Y        |

**代码示例**

```java
if (SGSDK.getInstance().isRewardAdReady(REWARD_ID,"home","test")) {
    SGSDK.getInstance().showRewardAd(this,REWARD_ID);
} else {
    ToastUtil.showNormalToast(this, "rewarded ad is not ready,Please wait for a munite");
    SGSDK.getInstance().loadRewardAd(this, REWARD_ID);
}
```

**4、广告是否已加载完成**

**应用场景**

在调用展示广告方法前，先调用此方法判断是有准备好的广告

**注：如果所接是<font color=red>茄子渠道</font>测接口调用形式传参为String unitId, String scene, String subPortal**

**方法定义**

```java
public boolean isRewardAdReady(Object... unitId)
```

**参数说明**

- 输入参数说明

| 参数      | 描述                                         | 是否必须 |
| --------- | -------------------------------------------- | -------- |
| adId      | 激励广告单元 ID                              | Y        |
| scene     | 广告展示的场景（接入茄子渠道需要传入）       | N        |
| subportal | 此次广告场景中的入口（接入茄子渠道需要传入） | N        |

- 返回值说明

  布尔值：true 表示广告已准备，可以展示，false 表示准备好的广告

**代码示例**

```java
SGSDK.getInstance().isRewardAdReady(String adId)
```



#### 6.3 ~~加载广告回调说明~~ (已废弃)

SDK 内设假如广告加载失败，相隔一定时间（默认 60s ）再次请求 5 次。5 次后继续失败将不在自动再次请求。

```java
import com.sgsdk.client.api.callback.IAdLoadListener;

onAdLoaded: 广告加载成功，source 表示广告平台，而不是通过admob中介设置的广告来源

onAdFailedToLoad： 广告加载失败，code 加载失败错误码»»»»
0:内部出现问题；例如，收到广告服务器的无效响应。
1:广告请求无效；例如，广告单元 ID 不正确。
2:由于网络连接问题，广告请求失败。
3:广告请求成功，但由于缺少广告资源，未返回广告。
```

#### 6.4 展示广告 回调说明

```java
import com.sgsdk.client.api.callback.IAdShowListener;

void onAdShowFailed(String adId, String source, String reason);

    void onAdShown(String adId, String source);

    void onAdLeftApplication(String adId, String source);

    void onAdClosed(String adId, String source);

    void onAdLoaded(String adId, String source);

    void onAdLoadFailed(String adId, String source,int errrocode,String reason);

    void onAdClicked(String adId, String source);

    void onAdHadRewared(String adId, String source,String type);
    
    /**
    *参数说明：
    *adId：广告id
    *source：广告源
    *errrocode：错误码 聚合广告平台错误码,详见聚合广告平台错误码说明
    *reason：错误原因
    *type：奖励类型
    */

```

| 回调方法            | 说明                                                         |
| ------------------- | ------------------------------------------------------------ |
| onAdLoaded          | 广告加载成功                                                 |
| onAdLoadFailed      | 广告加载失败，code 加载失败错误码，                          |
| onAdShowFailed      | 展示广告失败，unitId ,展示失败的广告 ID，reason 广告展示失败原因 |
| onAdShown           | 广告展示成功                                                 |
| onAdLeftApplication | 在用户点击打开其他应用（如 Google Play ）时，系统会调用此方法，从而在后台运行当前应用。 |
| onAdClosed          | 在用户点按“关闭”图标或使用“返回”按钮关闭插页式广告时，系统会调用此方法。如果您的应用暂停了音频输出或游戏循环，则非常适合使用此方法恢复这些活动。 |
| onAdClicked         | 广告被点击时系统会调用该方法                                 |
| onAdHadRewared      | 在用户因与广告互动而应获得奖励时，系统会调用此方法。type奖励的类型 |

聚合广告平台错误码说明

| 错误码  | 说明                                                         |
| ------- | ------------------------------------------------------------ |
| 0       | 内部出现问题；例如，收到广告服务器的无效响应。               |
| 1       | 广告请求无效；例如，广告单元 ID 不正确。                     |
| 2       | 由于网络连接问题，广告请求失败。                             |
| 3       | 广告请求成功，但由于缺少广告资源，未返回广告。               |
| -100001 | 广告参数传入不正确，请向运营提供所给广告 ID 是否已在广告平台配置 |

#### 6.5 添加测试设备接口

Admob 的中介测试必须使用添加测试设备方式，测试方式请参考admob链接：https://developers.google.com/admob/android/mediation-test-suite

金山世游SDK内添加测试设备 接口如下：（该接口只有在debug版SDK内生效）

```java
SGSDK.getInstance().setDevice(List<String> devices);
```

**注：由于SDK还在开发阶段，接入过程中有可能一些参数字段名称和实际SDK接入过程中的不符；如文档中描述的unitId和adId都是同一个意思都是表示的广告 id**




## 混淆规则

可根据开关添加不同的混淆规则

SGSDK 公共模块混淆配置

```proguard
# 屏蔽警告
-ignorewarnings
-keep public class com.sgsdk.client.api.** { *;}
-keep public class com.sgsdk.client.inner.** { *;}
-keep public class com.sgsdk.client.data.** { *;}
```

引入 google 登录模块混淆配置

```proguard
-keep public class com.google.api.services.** { *;}
-keep public class com.sgsdk.client.fun.google.inner.** { *;}
-keep public class com.google.api.client.googleapis.** { *;}
-keep class com.sgsdk.client.fun.google.inner.Gp$*{ *;}
-keepclassmembers class com.sgsdk.client.fun.google.inner.Gp$*{*;}
```



## 渠道接入特殊说明

### 金山世游海外官网渠道接入

**说明：** 金山世游海外官网渠道除包含上述功能外还包括打开活动页、绑定账号、Facebook 分享及 WhatsApp 分享等接口。具体接口如下。

**注意：接入官网包或需要接入 Google 登录 ，facebook 登录时如无特殊情况请使用金山世游提供的签名文件。**

**海外官网包额外配置项**

| 参数                | 描述                    | 值                                                           |
| ------------------- | ----------------------- | ------------------------------------------------------------ |
| HwRequestPermission | 是否需要SDK申请存储权限 | true = 启动时SDK会出现权限申请弹框                           |
| HwMustPermission    | 是否是必须申请存储权限  | true = 无权限时无法进入游戏（部分需要Google推荐的游戏必须有）；此值= true时，HwRequestPermission必须= true |

#### 直接使用具体登录方式登录说明

如果 cp 想直接调用官网渠道的官网登录，facebook登录，google登录，试玩登录登录方式，可以在登录中扩展参数中传入相应的配置

代码示例

```java
if (v.getId() == startButton1.getId()){
    //直接进行试玩登录
    SGSDK.getInstance().login(MainActivity.this, "{\"loginType\":1}");
}else if (v.getId() == startButton2.getId()){
    //直接进行官网登录
    SGSDK.getInstance().login(MainActivity.this, "{\"loginType\":2}");
}else if (v.getId() == startButton3.getId()){
    //直接进行 facebook 登录
    SGSDK.getInstance().login(MainActivity.this, "{\"loginType\":3}");
}else if (v.getId() == startButton4.getId()){
    //直接进行 google 登录
    SGSDK.getInstance().login(MainActivity.this, "{\"loginType\":4}");
}
```

#### 接入 Facebook 登录
> 细节请阅读 [SGSDK 版本升级指南](#SGSDK-版本升级指南)

1. 在 `kssgconfig.gradle` 添加 `Facebook` 依赖库

   ```groovy
   allprojects {
       repositories {
           //金山世游仓库
           maven { url "https://maven.shiyou.kingsoft.com/repository/public/" }
       }
   }
   
   dependencies {
       def SGSDK_VERSION = "1.0.6.1003" // 与发行商确认版本号
       api("com.sgsdk.component.channel:facebook:${SGSDK_VERSION}")
   }
   ```

2. 获取参数配置信息：参数值定义在 `sgsdk_config.properties`
   1. 在`sgsdk_config.properties`中在 key 值为`HwFunChannels`（如无则添加） 并后添加需要的功能渠道名，facebook 的为：`facebook` , 例如：`HwFunChannels = facebook,google`
   2. 确认 `facebookAppId` 值是否存在并正确。
   3. 确认 `facebookAppName` 值是否存在并正确。
   4. 确认 `facebookLoginProtocolScheme` 值是否存在并正确。

3. 配置 `Manifest` 信息
    **Facebook 应用信息所需要的 manifest 配置已内部集成，只需要确保 `sgsdk_config.properties` 相应参数正确即可。**

##### 关于 Facebook 登录切换账号问题的解释及操作教程

1. 现象：选择 facebook 登录成功后，选择切换账号，出现SG登录界面，再次选择 Facebook 登录，直接登录上次登录的FB 账号 ，不会跳转 facebook 页面重新输入账号。
2. 原因：Facebook 账号系统本身会对授权有缓存，在 token 未过期的情况下 调用Facebook 会直接获得授权信息，不重新出现授权页面。
3. Facebook 切换账号方法：
   1. 如果安装了 facebook 应用，可以在 facebook 应用切换账号 ，或到 设置里 找到 facebook 应用 清除数据，下次登录facebook 跳转 facebook 应用时会重新提示输入账号。
   2. 登录 网页版 facebook ，选择： 设置-应用与网站 会出现该账号授权过的应用面板，勾选对应游戏的应用，选择移除，则取消授权。再次选择facebook 账号登录，可以重新输入账号。



#### 接入 Google 登录
> 细节请阅读 [SGSDK 版本升级指南](#SGSDK-版本升级指南)
1. 在 `kssgconfig.gradle` 添加 `Google` 依赖库

      ```groovy
      allprojects {
          repositories {
              //金山世游仓库
              maven { url "https://maven.shiyou.kingsoft.com/repository/public/" }
          }
      }
      
      dependencies {
          def SGSDK_VERSION = "1.0.6.1003" // 与发行商确认版本号
          api("com.sgsdk.component.channel:google:${SGSDK_VERSION}")
      }
      ```

2. 配置 `Google` 应用信息
    1. 在配置文件中在 key值为`HwFunChannels`（如无则添加） 并后添加需要的功能渠道名，google 的为：`google` , 例如：`HwFunChannels = facebook,google`
    2. 确认 `googleServerClientId` 值是否存在并正确。

#### 额外接口介绍

##### 1、关联账号

##### 接口说明

关联账号 ，调起关联账号页面，设备登录用户绑定平台或其他三方账号

##### 接口方法

```java
SGSDK.getInstance().bindAccount(Activity activity, String customParams);
```

| 参数         | 说明                                                         |
| ------------ | ------------------------------------------------------------ |
| customParams | 该参数用于扩展，传输时使用json格式，接入时若不需要直接置空即可 |

##### 2、打开用户中心

##### 接口说明

用户中心 ，打开个人中心页面，可进行修改密码，查看个人信息等。

##### 接口方法及参数说明

```java
SGSDK.getInstance().openUserCenter();
```

##### 3、Facebook 分享

该接口可调起facebook分享，根据不同的字段决定是分享图片分享还是链接分享。

- facebook的链接分享不接收传入的图片。
- facebook 图片分享要求必须装有FB. APP 

```java
SGSDK.getInstance().share(Activity activity, ShareInfo shareInfo, ShareCallBack shareCallBack)
```

##### shareInfo 参数说明：

| 参数             | 类型   | 描述                                                         |
| ---------------- | ------ | ------------------------------------------------------------ |
| shareLinkUrl     | String | 分享的链接，**链接分享时不可为空**                           |
| sharePicturePath | String | 分享图片(传入本地存储上的文件路径)，传入空时，由SDK自动截图分享 |
| ext              | String | 扩展字段                                                     |
| shareType        | String | 分享类型，传入`shareLink`时表示链接分享，传入`shareImage`表示图片分享 |

##### 返回结果错误码如下：

```java
public static final int SHARE_FAILED = 1600;  // 分享失败
public static final int SHARE_CANCLE = 1601; // 取消分享
public static final int SHARE_APP_NOT_INSTALL = 1602; // 未安装Facebook 应用
public static final int SHARE_SUCCESS = 201; // 分享成功
```

##### 4、facebook 请求

##### 接口说明

Facebook邀请-挑战 ，邀请的另一种形式，与一种邀请的区别是不可编辑邀请好友内容，不可配置应用连接及邀请图片链接。

```java
SGSDK.getInstance().invite(InviteInfo info, InviteCallback callback);
```

**注：新版的SDK 只支持传入邀请的信息。**

**InviteInfo** 的参数解释如下：

| 参数        | 类型   | 描述       |
| ----------- | ------ | ---------- |
| channelName | String | 要分享消息 |

##### 5、打开通用的 web 页

**接口说明：**该接口在应用内打开一个webview，展示的内容由传入的 url 决定，比如传入 调查问卷的地址，打开的即是问卷调查系统。该接口只返回页面（webview）关闭的回调，其他回调不返回。
<font color=red>注意：后续打开调查问卷、活动页等请使用 统一接口介绍-扩展接口中 5.7 打开webview 接口，不可再使用该接口。</font>

```java
SGSDK.getInstance().openWebActivity(Activity activity, String url, String customParams);
```

**参数说明：**

| 参数         | 类型     | 说明                | 是否必须 |
| ------------ | -------- | ------------------- | -------- |
| activity     | Activity | 打开webview的上下文 | Y        |
| url          | String   | 需要打开的网页地址  | Y        |
| customParams | String   | 透传字段            | N        |

##### 6、通用接口

该接口是可调用除上述接口外的，可通过传入方法名称调用定制化接口，接口如下：

```java
SGSDK.getInstance().callSGMethod(String methodName, Object param, SGGenericCallBack callback, String customInfo);
```

**参数说明：**

| 参数       | 类型              | 描述           | 是否必传                        |
| ---------- | ----------------- | -------------- | ------------------------------- |
| methodName | String            | 方法名         | Y                               |
| params     | Object            | 方法携带的参数 | N                               |
| callback   | SGGenericCallBack | 接口回调       | N                               |
| customInfo | String            | 透传字段       | 如传入callback 则必须带透传字段 |

#### 官网可调用方法

##### 1、绑定提示页

该接口是当用户是纯游客且在某个游戏的节点时调用，**未登录或非纯游客用户不可调用。**游戏开发者可通过获取用户信息的`userInfo.accountBound`字段判断是否是纯游客。   **至于在哪个节点显示该页面请与运营核对。**

**方法名：`showBindTipsView`**

**调用示例：`SGSDK.getInstance().callSGMethod("showBindTipsView")`**

##### 2、多应用链接（图片）分享

**由于WhatsApp不支持网络图片分享，如果是分享网络图片，务必申请存储权限。**

该接口可根据传入的参数决定调用Facebook分享还是WhatsApp分享或两者可选框。

调用示例：

```java
ShareInfo shareInfo = new ShareInfo();
shareInfo.setShareChannel("FB");
shareInfo.setShareContent("test link share");
shareInfo.setShareLinkUrl("https://www.baidu.com");
shareInfo.setSharePictureUrl("http://img0.imgtn.bdimg.com/it/u=3386247472,87720242&fm=26&gp=0.jpg");
// 图片分享            
SGSDK.getInstance().callSGMethod("shareImageToApps", shareInfo, genericCallBack,"testImage");
// 链接分享
SGSDK.getInstance().callSGMethod("shareLinkToApps", shareInfo, genericCallBack,"testLink");
```

**shareInfo 参数说明：**

| 参数             | 类型   | 描述                                                         |
| ---------------- | ------ | ------------------------------------------------------------ |
| shareLinkUrl     | String | 分享的链接，**链接分享时不可为空**                           |
| sharePicturePath | String | 分享图片(传入本地存储上的文件路径)，传入空时，由SDK自动截图分享 |
| ext              | String | 扩展字段                                                     |
| shareChannel     | String | 分享的渠道，“FB” 表示 分享到Facebook,"WhatsApp" 表示分享到WhatsApp,其他表示出现包含这两个分享的提示框 |
| sharePictureUrl  | String | 分享图片(传入Internet上的URL地址)                            |
| shareType        | String | 分享类型，传入`shareLink`时表示链接分享，传入`shareImage`表示图片分享 |

**返回结果错误码如下：**

```java
public static final int SHARE_FAILED = 1600;  // 分享失败
public static final int SHARE_CANCLE = 1601; // 取消分享
public static final int SHARE_APP_NOT_INSTALL = 1602; // 未安装Facebook 应用
public static final int SHARE_SUCCESS = 201; // 分享成功
```

##### ~~3、打开客服~~

~~必须登录后调用。~~

~~调用示例：~~

```java
// 参数为上下文Activity
SGSDK.getInstance().callSGMethod("openFAQWeb",new Object[]{activity},null,null);
```

##### ~~4、跳转客服邮箱~~

```java
// 参数是 activity 上下文， 第二个参数是收件人邮箱地址
SGSDK.getInstance().callSGMethod("faqToEmail",new Object[]{activity,"zengmanyan@kingsoft.com"},null,null);
```

##### ~~5、获取客服新消息数量~~

~~必须登录后调用。~~

```java
SGSDK.getInstance().callSGMethod("getNewMessageNum",null,genericCallBack,"test");
```

##### ~~6、获取公告配置消息~~

~~调用示例：~~

```java
SGSDK.getInstance().callSGMethod("getAnnoSetting",null,genericCallBack,"test");
```

~~回调结果：info 字符串的为返回的公告配置。~~

##### 7、打开商店评分框

调用示例：

```
// 参数是上下文
SGSDK.getInstance().callSGMethod("showScoreDialog",new Object[]{activity},genericCallBack,"");
```

##### 8、获取第三方社交信息

**设置需要获取的配置信息：**

调用此接口可现在 `sgsdk_config.properties` 文件中配置需要获取的社交信息，不同的社交信息 用 `,` 隔开，配置 key 值为：`SgSocailInfos`。如未配置，默认只获取 平台 ID 和 昵称。例如：`SgSocailInfos=picture,gender`  。

**注意：**

1. 目前只支持获取 facebook 平台的社交信息
2. 目前只支持获取头像 `picture` 和 性别 `gender` 信息。

**接口说明：** 该接口可获取第三方登录平台头像、性别等社交信息。

**接口定义：**

```java
SGSDK.getInstance().callSGMethod("getSocailInfo",params,genericCallBack,"customInfo");
```

| 参数       | 类型   | 描述                                         | 是否必须 |
| ---------- | ------ | -------------------------------------------- | -------- |
| params     | String | 自定义参数，该方法不需要额外参数，传 “” 即可 | N        |
| customInfo | String | 透传字段                                     | N        |

**返回结果：**

```java
private SGGenericCallBack genericCallBack = new SGGenericCallBack() {
        @Override
        public void onSGGenericCallBack(int code, String customInfo, Object result) {
            //code：返回码，用于判断是否成功
            //customInfo：透传信息，调用通用接口callXGMethod时传入的customInfo
            //result ：返回结果
        }
    };

code // 返回错误码；错误码 含义如下
200 // 获取社交信息成功
1801 // 获取社交信息失败
1802 // 取消获取 社交信息
```

| 返回字段  | 类型                            | 描述         |
| --------- | ------------------------------- | ------------ |
| code      | int                             | 返回错误码   |
| cutomInfo | String                          | 透传字段     |
| result    | Object，在改接口为 `SocailInfo` | 返回信息对象 |

**关于SocailInfo说明：**

| 字段     | 类型   | 描述                        |
| -------- | ------ | --------------------------- |
| imageUrl | String | 头像地址                    |
| gender   | String | 性别，返回为：mal 或 female |
| nickName | String | 昵称                        |
| width    | int    | 头像宽度                    |
| height   | int    | 头像高度                    |

 <font color=red>**注意：**</font>

1. 获取 facebook 性别信息需要通过 facebook App 审核后方可使用。在测试阶段需要测试 获取 性别信息需要添加测试账号。
2. 获取测试账号方法：网页登录需要 添加为 测试账号 的 facebook 账号，进入个人主页，在浏览器链接地址后 id=XXXX 复制给 金山世游 运营负责人。请 金山世游 运营负责人在 facebook 后台添加测试账号。


##### 9、获取第三方好友信息

**设置需要获取的配置信息：**

调用此接口可在 `sgsdk_config.properties` 文件中配置需要获取的好友信息，不同的好友信息 用 `,` 隔开，配置 key 值为：`SgFriendInfos`。如未配置，默认只获取 平台 ID 和 昵称。例如：添加`SgFriendInfos=picture`是获取ID、
 昵称和头像，同时头像也含有其宽和高。

**注意：**

1. 目前只支持获取 facebook 平台的好友信息
2. 目前只支持获取头像 `picture`。

**接口说明：** 该接口可获取第三方登录平台头像、平台ID（默认）、平台昵称等社交信息。

**接口定义：**

```java
SGSDK.getInstance().callSGMethod("getFriendInfo","",genericCallBack,"getFriendInfo");
```

| 参数       | 类型   | 描述                                         | 是否必须 |
| ---------- | ------ | -------------------------------------------- | -------- |
| params     | String | 自定义参数，该方法不需要额外参数，传 “” 即可 | N        |
| customInfo | String | 透传字段                                     | N        |

**返回结果：**

```java
private SGGenericCallBack genericCallBack = new SGGenericCallBack() {
        @Override
        public void onSGGenericCallBack(int code, String customInfo, Object result) {

            //code：返回码，用于判断是否成功
            //customInfo：透传信息，调用通用接口callXGMethod时传入的customInfo
            //result ：返回结果

        }
};
```

| 返回字段  | 类型         | 描述                                          |
| --------- | ------------ | --------------------------------------------- |
| code      | int          | 返回错误码                                    |
| cutomInfo | String       | 透传字段                                      |
| result    | Object  （） | 获取到的好友信息, List<FbFriendInfo> 数据对象 |

**code 说明：**

| 值   | 描述             |
| ---- | ---------------- |
| 200  | 获取好友信息成功 |
| 1901 | 获取好友信息失败 |
| 1902 | 取消获取好友信息 |

**关于 FbFriendInfo 说明：**

| 字段     | 类型   | 描述      |
| -------- | ------ | --------- |
| id       | String | 第三方 id |
| nickName | String | 昵称      |
| imageUrl | String | 头像地址  |
| width    | int    | 头像宽度  |
| height   | int    | 头像高度  |

 <font color=red>**注意：**</font>

1. 获取 facebook 好友信息需要通过 facebook App 审核后方可使用。在测试阶段需要测试 获取 好友信息需要添加测试账号。
2. 获取测试账号方法：网页登录需要 添加为 测试账号 的 facebook 账号，进入个人主页，在浏览器链接地址后 id=XXXX 复制给 金山世游 运营负责人。请 金山世游 运营负责人在 facebook 后台添加测试账号。



### 茄子渠道接入特殊说明

#### 版本变更说明及渠道文档

2020-09-10

* 接入茄子SDK 2.1.2.1 版本

2020-06-19

* 接入茄子SDK 1.8.0.1 版本

2020-04-10

* 接入茄子SDK 1.2.7.0 版本

#### 茄子渠道 1.8.0.1 升级问题注意
> 请阅读 [编译问题 - 茄子 1.8.0.1 升级解决方案](sgsdk/client/编译问题.md)

#### 茄子 SDK 官方文档

| 文档名                | 链接                                                         |
| -------------------- | ------------------------------------------------------------ |
| 原生 Demo            | https://github.com/sunitsdk/SUnitDemo                        |
| 原生文档              | https://github.com/sunitsdk/SUnitDemo/wiki                   |
| Github Unity Demo   | https://github.com/sunitsdk/SUnitUnityDemo                   |
| Unity文档            | https://github.com/sunitsdk/SUnitUnityDemo/wiki              |
| 原生自测文档          | https://github.com/sunitsdk/SUnitDemo/wiki/SDK%E8%87%AA%E6%B5%8B |
| Unity自测文档        | https://github.com/sunitsdk/SUnitUnityDemo/wiki/SDK%E8%87%AA%E6%B5%8B |
| 支付文档             | https://docs.shareitpay.in                             |

#### 渠道名称

茄子渠道的渠道名称为：sunit

获取方法：

```java
SGSDK.getInstance().getChannelId()
```

#### 依赖库说明

```groovy
api("com.sgsdk.component.channel:sunit:${SGSDK_VERSION}")
```

#### 广告接口特殊说明

​		茄子渠道广告接口比较特殊，因为是茄子渠道内部已经做了广告缓存，所以 load 广告时不会向上层返回 onAdLoaded 和 onAdLoadFailed 广告回调通知，cp 调用相应广告的 load 方法后，根据相应的插屏、激励、横幅广告的是否准备方法去判断，如果返回 true 则调用相应的 show 方法来展示广告。

​		同时其判断插屏和激励方法需要传入相应的场景参数

示例如下：

```java
//插屏广告的判断
//参数分别为 广告id，广告展示场景
SGSDK.getInstance().isIntersitalAdReady(INTERSITIAL_ID,"home")
//激励广告的判断
//参数分别为 广告id，广告展示场景，子场景
SGSDK.getInstance().isRewardAdReady(REWARD_ID,"home","test")
```

#### callmethod 动态调用接口说明

茄子渠道需要接入激励广告数据上报功能

**接口说明：**

SGSDK.getInstance().callSGMethod("showRewardedBadgeView", params,null,null);

**代码示例：**

```java
String params = "{\"scene\":\"home\",\"subPortals\":[\"portal1\",\"portal2\"]}";
SGSDK.getInstance().callSGMethod("showRewardedBadgeView", params,null,null);

此接口必须要在主线程中调用

//scene 广告展示的场景（页面）
//subPortal 点击展示激励视频的按钮
scene、subPortal 需要传入

方法目的：统计激励视频从入口展示到用户点击之间的比例，方便做漏斗分析各个激励视频入口情况

上报场景：包含激励视频按钮的页面

调用时机：游戏场景从不可见到可见（打开弹窗或进入游戏场景；锁屏、home键、跳转其他场景后返回到原来场景），上报此页面内所有可点击激励视频入口。
```

#### 打开商店评分框
**应用场景**

此接口用于引导用户去应用商店评分

**方法调用**

```java
SGSDK.getInstance().callSGMethod("showScoreDialog", context, new SGGenericCallBack(){}, null);
```

**回调说明**

|    code  |   说明   |
| ---- | ---- |
|    200  |   评分引导回调成功   |
|    100  |   上下文为空   |
|    101  |   无网络连接   |

**代码示例**
```java
SGSDK.getInstance().callSGMethod("showScoreDialog", context, new SGGenericCallBack() {
    @Override
    public void onSGGenericCallBack(int code, String customInfo, Object result) {
        if (code == SGErrorCode.SUCCESS) {
            ToastUtil.showNormalToast(activity, "评分引导成功");
        } else {
            ToastUtil.showNormalToast(activity, "评分引导失败，code: " + code + " ,msg: " + result);
        }
    }
}, null);
```


#### AndroidManifest 文件配置说明
> 细节请阅读 [SGSDK 版本升级指南](#SGSDK-版本升级指南)

1. 确认 `sgsdk_config.properties` 的 `appId` 值是否存在并正确。
2. 如需要集成 `admob`，确认 `sgsdk_config.properties` 的 `googleAdmobAppid` 值是否存在并正确。
2. 如需要集成 `applovin`，确认 `sgsdk_config.properties` 的 `applovinKey` 值是否存在并正确。
2. 如需要集成 `flurry`，确认 `sgsdk_config.properties` 的 `flurryApiKey` 值是否存在并正确。
    ```xml
    <!-- 声明为'debug'则会使用测试模式（仅测试使用） -->
    <meta-data
           android:name="com.sunit.mode"
           android:value="debug" />
    <!-- 如果只有⼀一个Activity的应⽤⽆需声明此项,如果有多个activity,value为游戏场景所在的主 Activity路路径 -->
    <meta-data
           android:name="com.sunit.mainActivity"
           android:value="com.seasun.sgsdk_android.MainActivity" />
    ```

### Jio渠道接入特殊说明

Jio `minSdkVersion`最低要求 21

```groovy
android {
    defaultConfig {
        //jio 最低要求 21
        minSdkVersion 21
    }
}
```

### IMO 渠道接入特殊说明

#### 分享接口

**应用场景**

应用渠道要求，imo 渠道需要接入分享功能，目前分享主要支持链接分享，图片分享，群排行榜分享

**方法定义**

```java
public void sgShareViaChannel(Activity activity, ShareInfo shareInfo, ShareCallBack shareCallBack)
```

**参数说明**

- 输入参数说明

| 参数          | 说明                    |
| ------------- | ----------------------- |
| activity      | 分享操作页面的 activity |
| shareInfo     | 分享信息类              |
| shareCallBack | 分享完成后回调接口      |

- ShareInfo 参数说明

| 参数             | 类型   | 描述                                                         |
| ---------------- | ------ | ------------------------------------------------------------ |
| shareType        | String | 分享类型，KeyConfig.SHARE_IMAGE 图片分享、KeyConfig.SHARE_LINK 链接分享、KeyConfig.SHARE_GROUP 群排行榜分享 |
| shareTitle       | String | 分享标题                                                     |
| shareContent     | String | 分享描述                                                     |
| ext              | String | 扩展字段，传入分享场景，用于统计分类                         |
| sharePicturePath | String | 分享图片(传入本地存储上的文件路径)，图片大小不超过 8 M       |
| sharePictureUrl  | String | 图片链接，分享到 story                                       |
| shareLinkUrl     | String | 分享后，点击分享内容跳转的链接                               |

- ShareCallBack 回调接口说明

```java
public interface ShareCallBack {
   //分享成功回调	result成功描述信息
   public void onShareSuccess(Object result);
   //分享失败回调	error 失败描述信息
   public void onShareFail(Object error);

}
```

**代码示例**

- 链接分享调用示例

```java
ShareInfo shareInfo = new ShareInfo();
String trim = edit_content.getText().toString().trim();
shareInfo.setExt(trim);
shareInfo.setShareLinkUrl("https://www.xoyo.com/");
shareInfo.setShareTitle("分享测试");
shareInfo.setShareContent("Hello World");
shareInfo.setShareType(KeyConfig.SHARE_LINK);
SGSDK.getInstance().sgShareViaChannel(activity, shareInfo, new ShareCallBack() {
    @Override
    public void onShareFail(Object error) {
        ToastUtil.showNormalToast(activity, "share result:" + error.toString());
    }

    @Override
    public void onShareSuccess(Object result) {
        ToastUtil.showNormalToast(activity, "share result:" + result.toString());
    }
});
```

- 图片分享调用示例

```java
ShareInfo shareInfo = new ShareInfo();
String trim = edit_content.getText().toString().trim();
shareInfo.setExt(trim);
shareInfo.setSharePicturePath(picturePath);
shareInfo.setShareTitle("分享图片");
shareInfo.setShareContent("Hello World");
shareInfo.setShareType(KeyConfig.SHARE_IMAGE);
SGSDK.getInstance().sgShareViaChannel(activity, shareInfo, new ShareCallBack() {
    @Override
    public void onShareFail(Object error) {
        ToastUtil.showNormalToast(activity, "share result:" + error.toString());
    }

    @Override
    public void onShareSuccess(Object result) {
        ToastUtil.showNormalToast(activity, "share result:" + result.toString());
    }
});
```

- 群排行榜调用示例

```java
ShareInfo shareInfo = new ShareInfo();
String trim = edit_content.getText().toString().trim();
shareInfo.setExt(trim);
shareInfo.setShareLinkUrl("https://www.xoyo.com/");
shareInfo.setShareTitle("分享群排行榜");
shareInfo.setShareContent("Hello World");
shareInfo.setShareType(KeyConfig.SHARE_GROUP);
SGSDK.getInstance().sgShareViaChannel(activity, shareInfo, new ShareCallBack() {
    @Override
    public void onShareFail(Object error) {
        ToastUtil.showNormalToast(activity, "share result:" + error.toString());
    }

    @Override
    public void onShareSuccess(Object result) {
        ToastUtil.showNormalToast(activity, "share result:" + result.toString());
    }
});
```

### 华为 渠道接入特殊说明

#### 增加依赖配置
- build.gradle(Project)
    ```groovy
    buildscript {
        repositories {
            // 华为渠道
            maven {
                url "https://developer.huawei.com/repo/"
            }
        }
    
        dependencies {
            classpath "com.huawei.agconnect:agcp:1.4.1.300"
        }
    }
    allprojects {
        repositories {
            // 华为渠道
            maven {
                url "https://developer.huawei.com/repo/"
            }
        }
    }
    ```

- build.gradle(Moudle:app)
    ```groovy
    apply plugin: "com.huawei.agconnect"
    ```

- 添加 agconnect-services.json
    1. 将你的 agconnect-services.json 添加 (Moudle:app) 根目录
    2. 保证 sgsdk_config.properties里 的 appId&SgPackageName 与 agconnect-services.json 的 app_id&package_name 一致
    
    
## Q&A

> 请阅读 [SGSDK FAQ](sgsdk/client/faq.md)